<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Graphical data analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45631879-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45631879-4');
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MS-CSS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Graphical data analysis</h1>

</div>


<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(ggthemes)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(patchwork)

<span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">3</span>)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
<div id="graphical-data-analysis" class="section level1">
<h1>Graphical data analysis</h1>
<p>Graphical data analysis is fundamentally a creative process - it is not an exact science. It requires knowledge of your data and a lot of time. A lot of questions can be answered using GDA:</p>
<ol style="list-style-type: decimal">
<li>What type of variation occurs within my variables?</li>
<li>What type of covariation occurs between my variables?</li>
<li>Are there outliers in the data?</li>
<li>Do I have missingness? Are there patterns to it?</li>
<li>How much variation/error exists in my statistical estimates? Is there a pattern to it?</li>
</ol>
<div id="differences-between-gda-and-modeling" class="section level2">
<h2>Differences between GDA and modeling</h2>
<p>GDA is not the same thing as statistical modeling. Statistical modeling attempts to explain and summarize relationships between variables through a low-dimensional approach. For instance, in regression analysis we try to summarize the relationship between an outcome of interest and a predictor by estimating a parameter that summarizes the monotonic, linear relationship. Whereas in exploratory data analysis we are not limited to a strict functional form, or even focused on explaining relationships between variables (covariation).</p>
<p>Consider a dataset on tips given to a single waiter over a three-month period in a restaurant with the following variables:<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>obs</code></td>
<td>Observation number</td>
</tr>
<tr class="even">
<td><code>totbill</code></td>
<td>Total bill (cost of the meal), including tax, in US dollars</td>
</tr>
<tr class="odd">
<td><code>tip</code></td>
<td>Tip (gratuity) in US dollars</td>
</tr>
<tr class="even">
<td><code>sex</code></td>
<td>Sex of person paying for the meal (0=male, 1=female)</td>
</tr>
<tr class="odd">
<td><code>smoker</code></td>
<td>Smoker in party? (0=No, 1=Yes)</td>
</tr>
<tr class="even">
<td><code>day</code></td>
<td>3=Thur, 4=Fri, 5=Sat, 6=Sun</td>
</tr>
<tr class="odd">
<td><code>time</code></td>
<td>0=Day, 1=Night</td>
</tr>
<tr class="even">
<td><code>size</code></td>
<td>Size of the party</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tips &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/tips.csv&quot;</span>)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   obs = col_integer(),
##   totbill = col_double(),
##   tip = col_double(),
##   sex = col_character(),
##   smoker = col_character(),
##   day = col_character(),
##   time = col_character(),
##   size = col_integer()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(tips)</code></pre></div>
<pre><code>## Observations: 244
## Variables: 8
## $ obs     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,...
## $ totbill &lt;dbl&gt; 16.99, 10.34, 21.01, 23.68, 24.59, 25.29, 8.77, 26.88,...
## $ tip     &lt;dbl&gt; 1.01, 1.66, 3.50, 3.31, 3.61, 4.71, 2.00, 3.12, 1.96, ...
## $ sex     &lt;chr&gt; &quot;F&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;F&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;,...
## $ smoker  &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, ...
## $ day     &lt;chr&gt; &quot;Sun&quot;, &quot;Sun&quot;, &quot;Sun&quot;, &quot;Sun&quot;, &quot;Sun&quot;, &quot;Sun&quot;, &quot;Sun&quot;, &quot;Sun&quot;...
## $ time    &lt;chr&gt; &quot;Night&quot;, &quot;Night&quot;, &quot;Night&quot;, &quot;Night&quot;, &quot;Night&quot;, &quot;Night&quot;, ...
## $ size    &lt;int&gt; 2, 3, 3, 2, 4, 4, 2, 4, 2, 2, 2, 4, 2, 4, 2, 2, 3, 3, ...</code></pre>
<p>If our primary question is “what are the factors that affect tipping behavior?”, then we can quickly fit a linear regression model to explain this outcome:<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tips &lt;-<span class="st"> </span>tips <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tiprate =</span> tip <span class="op">/</span><span class="st"> </span>totbill)

tips_lm &lt;-<span class="st"> </span><span class="kw">lm</span>(tiprate <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>smoker <span class="op">+</span><span class="st"> </span>day <span class="op">+</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span>size, <span class="dt">data =</span> tips)
<span class="kw">tidy</span>(tips_lm)</code></pre></div>
<pre><code>## # A tibble: 8 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)  0.207     0.0249     8.29   8.65e-15
## 2 sexM        -0.00854   0.00835   -1.02   3.07e- 1
## 3 smokerYes    0.00364   0.00850    0.428  6.69e- 1
## 4 daySat      -0.00177   0.0183    -0.0967 9.23e- 1
## 5 daySun       0.0167    0.0190     0.876  3.82e- 1
## 6 dayThu      -0.0182    0.0232    -0.784  4.34e- 1
## 7 timeNight   -0.0234    0.0261    -0.895  3.72e- 1
## 8 size        -0.00962   0.00422   -2.28   2.34e- 2</code></pre>
<p>Based on this analysis, <code>size</code> is the only significant predictor. Quick answer to our original question. But is this sufficient?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glance</span>(tips_lm)</code></pre></div>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared  sigma statistic p.value    df logLik   AIC   BIC
## *     &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    0.0420        0.0136 0.0607      1.48   0.175     8   342. -665. -634.
## # ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>Our <span class="math inline">\(R^2\)</span> is just 0.042. That’s a pretty crappy model. And it misses a lot of other interesting aspects of the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tips, <span class="kw">aes</span>(tip)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="gda_files/figure-html/tips-hist-1.png" width="672" /></p>
<p>The histogram of tip amounts (binwidth = <span class="math inline">\(1\)</span>) shows the distribution is skewed right and unimodal. Overall the tips are not that large.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tips, <span class="kw">aes</span>(tip)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> .<span class="dv">1</span>)</code></pre></div>
<p><img src="gda_files/figure-html/tips-round-1.png" width="672" /></p>
<p>By shrinking the binwidth to <span class="math inline">\(.10\)</span>, we see a new phenomenon. Peaks occur at whole and half-dollar amounts, likely caused by customers picking round numbers for tips. We see this a lot too at the gas pump.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tips, <span class="kw">aes</span>(totbill, tip)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> .<span class="dv">18</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>),
                <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> tips <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">summarize</span>(<span class="dt">rsq =</span> <span class="kw">format</span>(<span class="kw">cor</span>(totbill, tip), <span class="dt">digits =</span> <span class="dv">3</span>)),
            <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">9</span>, <span class="dt">label =</span> rsq))</code></pre></div>
<p><img src="gda_files/figure-html/tips-scatter-1.png" width="672" /></p>
<p>By generating a scatterplot with a line representing a generous tipper (defined as a tip of 18%), we see that the majority of patrons are cheap tippers. The <span class="math inline">\(R^2\)</span> is decent for the observations, suggesting a moderate to strong correlation between the variables. But this correlation is not consistent across all observations in the data: there is more variation from the line as the total bill increases.</p>
<p>Of course we are also frequently interested in multiple variables and their covariation with one another, such as smoker and sex:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tips, <span class="kw">aes</span>(totbill, tip)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> .<span class="dv">18</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>),
                <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(smoker <span class="op">~</span><span class="st"> </span>sex, <span class="dt">labeller =</span> <span class="st">&quot;label_both&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> tips <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">group_by</span>(smoker, sex) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">summarize</span>(<span class="dt">rsq =</span> <span class="kw">format</span>(<span class="kw">cor</span>(totbill, tip), <span class="dt">digits =</span> <span class="dv">3</span>)),
            <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">9</span>, <span class="dt">label =</span> rsq))</code></pre></div>
<p><img src="gda_files/figure-html/tips-scatter-many-1.png" width="672" /></p>
<p>With the faceted scatterplot (with <span class="math inline">\(R^2\)</span> in the top-left of each facet), we can draw several comparisons and conclusions. For instance, non-smokers have a stronger correlation between total bill amount and tip size than smokers. Additionally for non-smokers, men tend to pay larger bills than women.</p>
<p>Without graphical analysis, we would have missed these nuances to the data.</p>
</div>
<div id="gda-vs.cda" class="section level2">
<h2>GDA vs. CDA</h2>
<p>GDA is heavily graphics-based and distinct from traditional confirmatory data analysis (CDA) techniques. CDA is the typical approach to quantitative research: identify a question of interest, develop a theory/hypothesis, collect data, and finally analyze it to confirm or refute your hypothesis. GDA is a distinct approach that could be called atheoretical, data snooping, inductive, etc. Given computational tools now available, there’s no reason to avoid GDA. GDA can be used to inform CDA by guiding our question selection and assessing the data for any violations of assumptions required for valid statistical inference.</p>
</div>
</div>
<div id="continuous-variables" class="section level1">
<h1>Continuous variables</h1>
<div id="common-plot-types" class="section level2">
<h2>Common plot types</h2>
<ul>
<li>Histogram</li>
<li>Density estimate</li>
<li>Boxplot</li>
</ul>
</div>
<div id="histograms" class="section level2">
<h2>Histograms</h2>
<p><strong>Histograms</strong> are graphical representations of the distribution of data. They attempt to estimate the probability distribution of a continuous variable by dividing the range of the variable into equal-width intervals called <strong>bins</strong>, counting the number of observations falling into each bin, and displaying the frequency counts in a bar chart.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">infant &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/infant.csv&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># remove non-countries</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(<span class="st">`</span><span class="dt">Value Footnotes</span><span class="st">`</span>) <span class="op">|</span><span class="st"> `</span><span class="dt">Value Footnotes</span><span class="st">`</span> <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">Country or Area</span><span class="st">`</span>, Year, Value) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">country =</span> <span class="st">`</span><span class="dt">Country or Area</span><span class="st">`</span>,
         <span class="dt">year =</span> Year,
         <span class="dt">mortal =</span> Value)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   `Country or Area` = col_character(),
##   Subgroup = col_character(),
##   Year = col_integer(),
##   Source = col_character(),
##   Unit = col_character(),
##   Value = col_integer(),
##   `Value Footnotes` = col_integer()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">10</span>, <span class="dt">boundary =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Histogram of infant mortality rate for 195 nations&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;10 bins, origin = 0&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/infant-hist-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">10</span>, <span class="dt">boundary =</span> <span class="op">-</span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Histogram of infant mortality rate for 195 nations&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;10 bins, origin = -5&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/infant-hist-2.png" width="672" /></p>
<p>Both histograms above use bins of width 10 but differ in their <strong>origin</strong>, or the starting point for the histogram. The first graph uses bins starting at 0 (e.g. 0 to 10, 10 to 20, 20 to 30), whereas the second graph uses bins starting at -5 (e.g. -5 to 5, 5 to 15, 15 to 25). Determining the optimal binwidth and origin point can be trial-and-error, though there are more complex options to try and optimize these values.</p>
</div>
<div id="density-estimation" class="section level2">
<h2>Density estimation</h2>
<p>In fact histograms are strongly related to <strong>nonparametric density estimation</strong>. Unlike histograms, which divide the data into discrete bins, nonparametric density estimation attempts to estimate the probability density function (PDF) of a variable based on a sample. Since the PDF is a smooth, continuous function, we can think of it like a smoothing histogram.</p>
<p>Histograms can also be thought of as simple density estimators, though rather than each bar representing a frequency count having it represent the proportion of observations in the sample that fall into the given bin.</p>
<p><span class="math inline">\(x_0\)</span> is the origin and each of the <span class="math inline">\(m\)</span> bins has width <span class="math inline">\(2h\)</span>. The end points of each bin are at <span class="math inline">\(x_0, x_0 + 2h, x_o + 4h, \dots, x_0 + 2mh\)</span>. An observation <span class="math inline">\(X_i\)</span> falls in the <span class="math inline">\(j\)</span>th bin if:</p>
<p><span class="math display">\[x_0 + 2(j - 1)h \leq X_i &lt; x_0 + 2jh\]</span></p>
<p>Therefore the histogram estimator of the density at any <span class="math inline">\(x\)</span> value located in the <span class="math inline">\(j\)</span>th bin is based the number of observations that fall into that bin:</p>
<p><span class="math display">\[\hat{p}(x) = \frac{\#_{i = 1}^n [x_0 + 2(j - 1)h \leq X_i &lt; x_0 + 2jh]}{2nh}\]</span></p>
<p>where <span class="math inline">\(\#\)</span> is the counting operator. If we remove the arbitrary origin <span class="math inline">\(x_0\)</span> by counting locally within a continuously moving window of half-width <span class="math inline">\(h\)</span> centered at <span class="math inline">\(x\)</span>:</p>
<p><span class="math display">\[\hat{p}(x) = \frac{\#_{i = 1}^n [x-h \leq X_i &lt; x+h]}{2nh}\]</span></p>
<p>We can generalize this equation to evaluate <span class="math inline">\(\hat{p}(x)\)</span> at a large number of <span class="math inline">\(x\)</span> values covering the range of <span class="math inline">\(X\)</span> by applying a locally weighted averaging function using a rectangular weight function:</p>
<p><span class="math display">\[\hat{p}(x) = \frac{1}{nh} \sum_{i = 1}^n W \left( \frac{x - X_i}{h} \right)\]</span></p>
<p>where</p>
<p><span class="math display">\[W(z) = \begin{cases} 
      \frac{1}{2} &amp; \text{for } |z| &lt; 1 \\
      0 &amp; \text{otherwise} \\
   \end{cases}\]</span></p>
<p><span class="math display">\[z = \frac{x - X_i}{h}\]</span></p>
<p>This <strong>naive estimator</strong> is very similar to a histogram that uses bins of width <span class="math inline">\(2h\)</span> but has no fixed origin.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">kernel =</span> <span class="st">&quot;rectangular&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Naive density estimator of infant mortality rate for 195 nations&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Density&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>The downside to the rectangular weighting function is that the resulting density plot is not very clean and smooth. As observations enter and exit the window defined by the rectangle <span class="math inline">\(W(z)\)</span>, the resulting estimator is rough.</p>
<p>The rectangular weighting function produces a density estimate which covers an area of <span class="math inline">\(1\)</span>; that is, integrating over the range of <span class="math inline">\(X\)</span> for <span class="math inline">\(\hat{p}(x)\)</span> yields a value of 1. Any function that has this property (such as a probability density function) can be used as a weight function.</p>
<p>Another term for a weight function is a <strong>kernel</strong>. We should select a kernel that is smooth, symmertric, and unimodal to smooth out these rough edges of the naive density estimator. Therefore we can write the general density estimator as:</p>
<p><span class="math display">\[\hat{x}(x) = \frac{1}{nh} \sum_{i = 1}^k K \left( \frac{x - X_i}{h} \right)\]</span></p>
<p>and substitute for <span class="math inline">\(K(z)\)</span> any other kernel.</p>
<div id="gaussian-kernel" class="section level5">
<h5>Gaussian kernel</h5>
<p><span class="math display">\[K(z) = \frac{1}{\sqrt{2 \pi}}e^{-\frac{1}{2} z^2}\]</span></p>
<p>Not to be confused with the <a href="persp009_svm.html#kernels">(Gaussian) radial basis function kernel</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>)

{
  <span class="kw">qplot</span>(x, <span class="dt">geom =</span> <span class="st">&quot;blank&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Gaussian (normal) kernel&quot;</span>,
         <span class="dt">x =</span> <span class="ot">NULL</span>,
         <span class="dt">y =</span> <span class="ot">NULL</span>)
} <span class="op">+</span>
{
  <span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">kernel =</span> <span class="st">&quot;gaussian&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Infant mortality rate for 195 nations&quot;</span>,
         <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;Density&quot;</span>)
}</code></pre></div>
<p><img src="gda_files/figure-html/gaussian-1.png" width="672" /></p>
<p>Now we have a much smoother density function.</p>
</div>
<div id="rectangular-uniform-kernel" class="section level5">
<h5>Rectangular (uniform) kernel</h5>
<p><span class="math display">\[K(z) = \frac{1}{2} \mathbf{1}_{\{ |z| \leq 1 \} }\]</span></p>
<p>where <span class="math inline">\(\mathbf{1}_{\{ |z| \leq 1 \} }\)</span> is an indicator function that takes on the value of 1 if the condition is true (<span class="math inline">\(|z| \leq 1\)</span>) or 0 if the condition is false. This is the naive density estimator identified previously.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1000</span>, <span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>)
x_lines &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>x, <span class="op">~</span>y, <span class="op">~</span>xend, <span class="op">~</span>yend,
  <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, .<span class="dv">5</span>,
  <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">5</span>
)

{
  <span class="kw">qplot</span>(x, <span class="dt">geom =</span> <span class="st">&quot;blank&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dunif, <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">min =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">geom =</span> <span class="st">&quot;step&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="co"># geom_segment(data = x_lines, aes(x = x, y = y, xend = xend, yend = yend)) +</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Rectangular kernel&quot;</span>,
         <span class="dt">x =</span> <span class="ot">NULL</span>,
         <span class="dt">y =</span> <span class="ot">NULL</span>)
} <span class="op">+</span>
{
  <span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">kernel =</span> <span class="st">&quot;rectangular&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Infant mortality rate for 195 nations&quot;</span>,
         <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;Density&quot;</span>)
}</code></pre></div>
<p><img src="gda_files/figure-html/uniform-1.png" width="672" /></p>
</div>
<div id="triangular-kernel" class="section level5">
<h5>Triangular kernel</h5>
<p><span class="math display">\[K(z) = (1 - |z|) \mathbf{1}_{\{ |z| \leq 1 \} }\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">triangular &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">abs</span>(x)) <span class="op">*</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">abs</span>(x) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)
}

{
  <span class="kw">qplot</span>(x, <span class="dt">geom =</span> <span class="st">&quot;blank&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> triangular) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Triangular kernel&quot;</span>,
         <span class="dt">x =</span> <span class="ot">NULL</span>,
         <span class="dt">y =</span> <span class="ot">NULL</span>)
} <span class="op">+</span>
{
  <span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">kernel =</span> <span class="st">&quot;triangular&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Infant mortality rate for 195 nations&quot;</span>,
         <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;Density&quot;</span>)
}</code></pre></div>
<p><img src="gda_files/figure-html/triangular-1.png" width="672" /></p>
</div>
<div id="quartic-biweight-kernel" class="section level5">
<h5>Quartic (biweight) kernel</h5>
<p><span class="math display">\[K(z) = \frac{15}{16} (1 - z^2)^2 \mathbf{1}_{\{ |z| \leq 1 \} }\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">biweight &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  (<span class="dv">15</span> <span class="op">/</span><span class="st"> </span><span class="dv">16</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x<span class="op">^</span><span class="dv">2</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">abs</span>(x) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)
}

{
  <span class="kw">qplot</span>(x, <span class="dt">geom =</span> <span class="st">&quot;blank&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> biweight) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Biweight kernel&quot;</span>,
         <span class="dt">x =</span> <span class="ot">NULL</span>,
         <span class="dt">y =</span> <span class="ot">NULL</span>)
} <span class="op">+</span>
{
  <span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">kernel =</span> <span class="st">&quot;biweight&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Infant mortality rate for 195 nations&quot;</span>,
         <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;Density&quot;</span>)
}</code></pre></div>
<p><img src="gda_files/figure-html/biweight-1.png" width="672" /></p>
</div>
<div id="epanechnikov-kernel" class="section level5">
<h5>Epanechnikov kernel</h5>
<p><span class="math display">\[K(z) = \frac{3}{4} (1 - z^2) \mathbf{1}_{\{ |z| \leq 1 \} }\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">epanechnikov &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  (<span class="dv">15</span> <span class="op">/</span><span class="st"> </span><span class="dv">16</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x<span class="op">^</span><span class="dv">2</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">abs</span>(x) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)
}

{
  <span class="kw">qplot</span>(x, <span class="dt">geom =</span> <span class="st">&quot;blank&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> epanechnikov) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Epanechnikov kernel&quot;</span>,
         <span class="dt">x =</span> <span class="ot">NULL</span>,
         <span class="dt">y =</span> <span class="ot">NULL</span>)
} <span class="op">+</span>
{
  <span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Infant mortality rate for 195 nations&quot;</span>,
         <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;Density&quot;</span>)
}</code></pre></div>
<p><img src="gda_files/figure-html/epanechnikov-1.png" width="672" /></p>
</div>
<div id="comparison-of-kernels" class="section level5">
<h5>Comparison of kernels</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span>(x, <span class="dt">geom =</span> <span class="st">&quot;blank&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_function</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Gaussian&quot;</span>), <span class="dt">fun =</span> dnorm) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_function</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Epanechnikov&quot;</span>), <span class="dt">fun =</span> epanechnikov) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_function</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Rectangular&quot;</span>), <span class="dt">fun =</span> dunif,
                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">min =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">geom =</span> <span class="st">&quot;step&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_function</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Triangular&quot;</span>), <span class="dt">fun =</span> triangular) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_function</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Biweight&quot;</span>), <span class="dt">fun =</span> biweight) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>,
       <span class="dt">y =</span> <span class="ot">NULL</span>,
       <span class="dt">color =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.04</span>, <span class="dv">1</span>),
        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),
        <span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>))</code></pre></div>
<p><img src="gda_files/figure-html/kernels-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Gaussian&quot;</span>), <span class="dt">kernel =</span> <span class="st">&quot;gaussian&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Epanechnikov&quot;</span>), <span class="dt">kernel =</span> <span class="st">&quot;epanechnikov&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Rectangular&quot;</span>), <span class="dt">kernel =</span> <span class="st">&quot;rectangular&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Triangular&quot;</span>), <span class="dt">kernel =</span> <span class="st">&quot;triangular&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Biweight&quot;</span>), <span class="dt">kernel =</span> <span class="st">&quot;biweight&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Density estimators of infant mortality rate for 195 nations&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Density&quot;</span>,
       <span class="dt">color =</span> <span class="st">&quot;Kernel&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.96</span>, <span class="dv">1</span>),
        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),
        <span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>))</code></pre></div>
<p><img src="gda_files/figure-html/kernels-2.png" width="672" /></p>
</div>
<div id="selecting-the-bandwidth-h" class="section level4">
<h4>Selecting the bandwidth <span class="math inline">\(h\)</span></h4>
<p>Even within the same kernel, different values for the bandwidth <span class="math inline">\(h\)</span> will produce different density estimates because the moving window used to include observations in the local estimate will change.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(mortal)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">kernel =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">adjust =</span> <span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">kernel =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">adjust =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">kernel =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">adjust =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">linetype =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Gaussian density estimators of infant mortality rate for 195 nations&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Three different bandwidth parameters&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Density&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/gaussian-h-1.png" width="672" /></p>
<p>If the underlying density of the sample is normal with standard deviation <span class="math inline">\(\sigma\)</span>, then for the Gaussian kernel estimation the most efficient bandwidth <span class="math inline">\(h\)</span> will be:</p>
<p><span class="math display">\[h = 0.9 \sigma n^{-1 / 5}\]</span></p>
<p>As the sample size increases, the optimal window narrows and permits finer detail than a smaller sample. Of course we don’t actually know the population standard deviation <span class="math inline">\(\sigma\)</span>. Instead we know the sample standard deviation <span class="math inline">\(s\)</span>. If the underlying density is normal, we could just substitute <span class="math inline">\(s\)</span> as an unbiased estimate for <span class="math inline">\(\sigma\)</span>. Of course the problem is that we <strong>assumed</strong> the underlying density is normal. If this is not true, then it’s possible that the sample standard deviation is inflated. In that case, we can adjust by using an “adaptive” estimator of spread:</p>
<p><span class="math display">\[A = \min \left( S, \frac{IQR}{1.349} \right)\]</span></p>
<p>where <span class="math inline">\(IQR\)</span> is the interquartile range of the sample and 1.349 is the interquartile range of the standard normal distribution <span class="math inline">\(N(0,1)\)</span>.</p>
<p>This is the default method for calculating the bandwidth with a Gaussian kernel using the <code>density()</code> function in R. Other kernels use different functions for determining the optimal value for <span class="math inline">\(h\)</span>.</p>
</div>
</div>
<div id="boxplot" class="section level2">
<h2>Boxplot</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(<span class="st">&quot;&quot;</span>, mortal)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Boxplot of infant mortality rate for 195 nations&quot;</span>,
       <span class="dt">x =</span> <span class="ot">NULL</span>,
       <span class="dt">y =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/boxplot-1.png" width="672" /></p>
<p>A <strong>box plot</strong> or <strong>boxplot</strong> is a method for graphically depicting groups of numerical data through their quartiles. Box plots may also have lines extending vertically from the boxes (whiskers) indicating variability outside the upper and lower quartiles, hence the terms box-and-whisker plot and box-and-whisker diagram. Outliers may be plotted as individual points.</p>
<ul>
<li>Bottom and top of the box always represent the first and third quartiles</li>
<li>Band inside the box is always the second quartile (the median)</li>
<li>Ends of whiskers may vary depending on what package is used to generate the boxplot
<ul>
<li>Lowest and highest data points within 1.5 of the <strong>interquartile range</strong> (difference between first and third quartiles) - also known as a Tukey boxplot</li>
</ul></li>
<li>Remaining data points are plotted as an outlier with a dot</li>
</ul>
<p>This plot is not typically used for a single variable and grouping - because of its compactness, boxplots are useful for comparing distributions across or among subgroups in the data</p>
<div id="violin-plot" class="section level4">
<h4>Violin plot</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(infant, <span class="kw">aes</span>(<span class="st">&quot;&quot;</span>, mortal)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Violin plot of infant mortality rate for 195 nations&quot;</span>,
       <span class="dt">x =</span> <span class="ot">NULL</span>,
       <span class="dt">y =</span> <span class="st">&quot;Infant mortality rate (per 1,000)&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/violin-1.png" width="672" /></p>
<p>A <strong>violin plot</strong> is a compact display of a continuous distribution. In essence, it is a mirrored density plot displayed in the same way as a boxplot. Because a boxplot only reports summary statistics, a violin plot is more useful if you want to compare or show the presence of different peaks, their position, and relative amplitude.</p>
</div>
</div>
<div id="things-to-look-for-in-continuous-variables" class="section level2">
<h2>Things to look for in continuous variables</h2>
<ul>
<li>Assymetry - the distribution is skewed to the left or the right</li>
<li>Outliers - there are one or more values that are far from the rest of the data</li>
<li>Multimodality - the distribution has more than one peak</li>
<li>Gaps - there are ranges of values within the data where no cases are reported</li>
<li>Heaping - some values occur unexpectedly often</li>
<li>Rounding - only certain values are found</li>
<li>Impossibilities - values outside the feasible range</li>
<li>Errors - values that look wrong for one reason or another</li>
</ul>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<div id="galtons-heights" class="section level3">
<h3>Galton’s heights</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(galton, <span class="dt">package =</span> <span class="st">&quot;UsingR&quot;</span>)

galton_tidy &lt;-<span class="st">  </span><span class="kw">as_tibble</span>(galton) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(person, height)

<span class="kw">ggplot</span>(galton_tidy, <span class="kw">aes</span>(height)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>person, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/get-galton-1.png" width="672" /></p>
<p><code>galton</code> contains heights (in inches) for 928 children and 205 “midparents”. Each parent height is an average of the father’s height and 1.08 times the mother’s height. The daughters’ heights are aslo said to have been multiplied by 1.08. This dataset was famously used by Sir Francis Galton to develop theories of correlation and regression in the 19th century.</p>
<p>Above we see two histograms plotted, one for the children and one for the parents. Each has the same binwidth (1 inch). While they look symmetric with no outliers, it is difficult to directly compare the histograms because they use different scales for the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> axes.</p>
<div id="investigate-for-gaps-or-heaping" class="section level4">
<h4>Investigate for gaps or heaping</h4>
<p>We should draw histograms with smaller bins.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(galton_tidy, <span class="kw">aes</span>(height)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> .<span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>person, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/galton-heaping-1.png" width="672" /></p>
<p>We can see that there are only a limited number of unique values used for height. In both histograms there appear to be narrow gaps between each bar. In fact, if we were to look at the original data, we’d see that nearly all the children’s heights end in <span class="math inline">\(.0\)</span> and <span class="math inline">\(.5\)</span>, whereas all the adults’ heights end in <span class="math inline">\(.2\)</span> and <span class="math inline">\(.7\)</span>. This suggests limited precision in the estimates of height.</p>
</div>
<div id="comparing-the-distributions" class="section level4">
<h4>Comparing the distributions</h4>
<p>If we want to directly compare the distribution of children and adult heights, how can we do this? One approach is to draw both histograms on the same plot and distinguish each distribution by color.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(galton_tidy, <span class="kw">aes</span>(height, <span class="dt">fill =</span> person)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>()</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="gda_files/figure-html/galton-both-1.png" width="672" /></p>
<p>Oops, this is not really any good. Bars are being drawn overtop of one another and it is not possible to follow along. We could instead draw a separate histogram for each distribution in two separate grids <strong>but use the same <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> axis scales</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">galton_median &lt;-<span class="st"> </span>galton_tidy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(person) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">median =</span> <span class="kw">median</span>(height))

<span class="kw">ggplot</span>(galton_tidy) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(height), <span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> galton_median, <span class="kw">aes</span>(<span class="dt">xintercept =</span> median), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>person, <span class="dt">ncol =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="gda_files/figure-html/galton-sep-1.png" width="672" /></p>
<p>Or I find it easier if we put the data on the same panel, either using a density estimate or a boxplot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(galton_tidy, <span class="kw">aes</span>(height, <span class="dt">color =</span> person)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre></div>
<p><img src="gda_files/figure-html/galton-density-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(galton_tidy, <span class="kw">aes</span>(person, height)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="gda_files/figure-html/galton-box-1.png" width="672" /></p>
<p>Both plots suggest that while the medians are similar, the parents’ heights have far less variation than the children’s heights. In fact, this makes perfect sense because the parents’ heights are themselves an average of mother and father, so we should expect less variation.</p>
</div>
</div>
<div id="outlier-detection" class="section level3">
<h3>Outlier detection</h3>
<p><code>ggplot2movies</code> contains a dataset called <code>movies</code>, with information on over 58,000 movies collected from IMDB. One of the variables it collects is <code>length</code>, or the runtime of the film in minutes. What is the distribution of this continuous variable?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(movies, <span class="dt">package =</span> <span class="st">&quot;ggplot2movies&quot;</span>)

<span class="kw">ggplot</span>(movies, <span class="kw">aes</span>(length)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>()</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="gda_files/figure-html/movies-hist-1.png" width="672" /></p>
<p>This plot is not very useful, except that it tells us we have at least one <strong>outlier</strong>, or extremely long movie, in the data. This is why the data appears heavily skewed. With over 58,000 movies in the first two bins, one case will never be visible. This histogram is not very useful here.</p>
<p>A boxplot, on the other hand, does a nice job of summarizing and visualizing outliers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(movies, <span class="kw">aes</span>(<span class="st">&quot;&quot;</span>, length)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>)</code></pre></div>
<p><img src="gda_files/figure-html/movies-box-1.png" width="672" /></p>
<p>There are actually quite a few outliers in the data. We could now use this information to filter the dataset and find out which movies these are: are they errors in coding the observation, or just an extremely long film?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(movies, length <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 24
##   title  year length budget rating votes    r1    r2    r3    r4    r5
##   &lt;chr&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Cure…  1987   5220     NA    3.8    59  44.5   4.5   4.5   4.5     0
## 2 Four…  1967   1100     NA    3      12  24.5   0     4.5   0       0
## 3 Long…  1970   2880     NA    6.4    15  44.5   0     0     0       0
## # ... with 13 more variables: r6 &lt;dbl&gt;, r7 &lt;dbl&gt;, r8 &lt;dbl&gt;, r9 &lt;dbl&gt;,
## #   r10 &lt;dbl&gt;, mpaa &lt;chr&gt;, Action &lt;int&gt;, Animation &lt;int&gt;, Comedy &lt;int&gt;,
## #   Drama &lt;int&gt;, Documentary &lt;int&gt;, Romance &lt;int&gt;, Short &lt;int&gt;</code></pre>
<p>In fact all of these movies exist, and their lengths are accurate.</p>
<p>If we want to investigate and explore this dataset further, we have to decide how to proceed. Since 99% of all the observations in the dataset have run times lower than three hours, let’s just look at those observations. Compare the following graphs: which appears the most useful?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies_lite &lt;-<span class="st"> </span><span class="kw">filter</span>(movies, length <span class="op">&lt;=</span><span class="st"> </span><span class="dv">180</span>)

<span class="kw">ggplot</span>(movies_lite, <span class="kw">aes</span>(<span class="st">&quot;&quot;</span>, length)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>,
       <span class="dt">y =</span> <span class="st">&quot;Movie length (in minutes)&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/movies-all-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(movies_lite, <span class="kw">aes</span>(length)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Movie length (in minutes)&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/movies-all-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(movies_lite, <span class="kw">aes</span>(length)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Movie length (in minutes)&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/movies-all-3.png" width="672" /></p>
<p>I think the third plot provides the most information:</p>
<ol style="list-style-type: decimal">
<li>There are few long films (i.e. over 2 and a half hours)</li>
<li>There is a distinct group of short films with a peak of 7 minutes</li>
<li>There is a sharp peak at a length of 90 minutes.</li>
<li>There is clear evidence of round numbers being favored.</li>
</ol>
</div>
<div id="compare-distributions-of-subgroups" class="section level3">
<h3>Compare distributions of subgroups</h3>
<p>Recall the earlier example of using a density estimate to compare the distribution of heights for children and parents:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(galton_tidy, <span class="kw">aes</span>(height, <span class="dt">color =</span> person)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre></div>
<p><img src="gda_files/figure-html/galton-density2-1.png" width="672" /></p>
<p>This worked because we were only comparing between two subgroups. What happens if we want to compare across more than that? At what point does the density estimate not prove effective anymore?</p>
<p>Let’s consider <code>movies</code> and compare the distribution of film length by <strong>genre</strong> using a density estimate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">genre &lt;-<span class="st"> </span>movies_lite <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(genre, value, Action<span class="op">:</span>Short) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(value <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>value)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(genre, <span class="kw">aes</span>(length, <span class="dt">color =</span> genre)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/genre-density-1.png" width="672" /></p>
<p>This is really messy - can we learn much from it? There still appear to be two peaks for each genre of film, but beyond that I cannot really tell a story from this. What are our alternative options?</p>
<div id="multiple-windows-plot" class="section level4">
<h4>Multiple windows plot</h4>
<p>A <strong>multiple windows plot</strong> (also known as a <strong>trellis plot</strong> or <strong>facet graph</strong>) splits dataset by some subgrouping and draws the exact same graph for each subgroup. The benefit is that by putting everything in the same overall graph, each mini-graph is directly shared with the other mini-graphs. Comparisons can sometimes be made more easily in this manner, rather than subsetting the dataset and creating the same graph multiple times through an iterative operation.</p>
<p>We could recreate the original histogram for movie length, but facet it by genre:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(genre, <span class="kw">aes</span>(length)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Movie length (in minutes)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>genre)</code></pre></div>
<p><img src="gda_files/figure-html/genre-facet-1.png" width="672" /></p>
<p>There is still a lot going on here, but I think it’s easier to digest than the density estimate with multiple colors. We can see that over all there are far more comedies, dramas, and short films than any other category. The bimodal peaks still seem to apply to comedies, but beyond that it is not clear other genres have the same feature. Short films and animations appear to have a single peak around 10 minutes or so, whereas action films, documentaries, and romances appear to have a single peak closer to 90 minutes. Perhaps genre explains the bimodality in the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(genre, <span class="kw">aes</span>(length)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Movie length (in minutes)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>genre, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/genre-facet-freey-1.png" width="672" /></p>
<p>We can adjust the <span class="math inline">\(y\)</span> axes to freely adjust to the natural peak of each subgroup. This distorts the comparisons between groups in that we cannot see immediately that comedies and dramas dominate the dataset, but it does zoom in a bit more on the smaller categories without switching entirely to a density estimate (we can still observe heaping). The story remains pretty similar.</p>
</div>
<div id="boxplot-1" class="section level4">
<h4>Boxplot</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(genre, <span class="kw">aes</span>(genre, length)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Genre&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Movie length (in minutes)&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/genre-box-1.png" width="672" /></p>
<p>A boxplot reveals the clear differences in median run time and the fact that each genre has a substantial number of outliers, but I don’t know if it reveals quite the same story. Do you see anything different?</p>
</div>
</div>
</div>
</div>
<div id="categorical-variables" class="section level1">
<h1>Categorical variables</h1>
<p><strong>Categorical variables</strong> are discrete variables with a fixed set of possible values.</p>
<div id="types-of-charts" class="section level2">
<h2>Types of charts</h2>
<div id="bar-chart" class="section level3">
<h3>Bar chart</h3>
<p>A bar chart is pretty simple: one bar for each value of the variable, and the height of the bar is equal to the number of obsrvations falling in that category.</p>
<p>Let’s consider a sample of data from the <strong>General Social Survey</strong>, which is a long-running US survey conducted by NORC at the University of Chicago. The survey has thousands of questions about social and political behavior, and is one of the most important surveys in social science.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(forcats)
gss_cat</code></pre></div>
<pre><code>## # A tibble: 21,483 x 9
##     year marital     age race  rincome   partyid   relig   denom   tvhours
##    &lt;int&gt; &lt;fct&gt;     &lt;int&gt; &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;     &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;
##  1  2000 Never ma…    26 White $8000 to… Ind,near… Protes… Southe…      12
##  2  2000 Divorced     48 White $8000 to… Not str … Protes… Baptis…      NA
##  3  2000 Widowed      67 White Not appl… Independ… Protes… No den…       2
##  4  2000 Never ma…    39 White Not appl… Ind,near… Orthod… Not ap…       4
##  5  2000 Divorced     25 White Not appl… Not str … None    Not ap…       1
##  6  2000 Married      25 White $20000 -… Strong d… Protes… Southe…      NA
##  7  2000 Never ma…    36 White $25000 o… Not str … Christ… Not ap…       3
##  8  2000 Divorced     44 White $7000 to… Ind,near… Protes… Luther…      NA
##  9  2000 Married      44 White $25000 o… Not str … Protes… Other         0
## 10  2000 Married      47 White $25000 o… Strong r… Protes… Southe…       3
## # ... with 21,473 more rows</code></pre>
<p>A simple bar chart tells us the racial makeup of the survey respondents:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(gss_cat, <span class="kw">aes</span>(race)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="gda_files/figure-html/race-bar-1.png" width="672" /></p>
<p>So we can see that there are approximately 16,000 whites, 3000 blacks, and 2000 “other”.</p>
<div id="concerns-with-bar-charts" class="section level4">
<h4>Concerns with bar charts</h4>
<div id="omitted-categories" class="section level5">
<h5>Omitted categories</h5>
<p>One thing to be careful when building bar charts is omitting categories from the graph. For example, the race question includes a fourth possible response:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(gss_cat, <span class="kw">aes</span>(race)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">drop =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="gda_files/figure-html/race-bar-omit-1.png" width="672" /></p>
<p>These levels represent valid values that simply did not occur in this dataset. You probably would want to omit this in the final paper where you publish the graph, but for GDA purposes it may be important to keep in your graph.</p>
</div>
<div id="order-matters" class="section level5">
<h5>Order matters</h5>
<p>Consider the following graph of the average number of hours spent watching TV per day across religions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">relig_summary &lt;-<span class="st"> </span>gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(relig) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">age =</span> <span class="kw">mean</span>(age, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">tvhours =</span> <span class="kw">mean</span>(tvhours, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">n =</span> <span class="kw">n</span>()
  )

<span class="kw">ggplot</span>(relig_summary, <span class="kw">aes</span>(relig, tvhours)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="gda_files/figure-html/relig-bar-1.png" width="672" /></p>
<p>Religion is a <strong>nominal variable</strong> - there is no inherent ordering to the variable. So why order the bars in this way? Simply, this was the default order. But we don’t have to keep it this way. You probably want to draw the graph in an order that makes sense given some overall pattern. For instance, should we order it alphabetically?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(relig_summary, <span class="kw">aes</span>(<span class="kw">factor</span>(relig, <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">sort</span>(<span class="kw">levels</span>(relig)))), tvhours)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="gda_files/figure-html/relig-alpha-1.png" width="672" /></p>
<p>Hmm. Not really useful here. What about instead sorting in order of most TV watched to least TV watched?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(relig_summary, <span class="kw">aes</span>(<span class="kw">fct_reorder</span>(relig, tvhours), tvhours)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="gda_files/figure-html/relig-order-1.png" width="672" /></p>
<p>This makes more sense because we can make direct comparisons based on the number of TV hours watched, which we probably care about most in this situation.</p>
<p>What if we create a similar plot looking at how average age varies across reported income level? Notice also that instead of a bar graph, I draw a <strong>dot graph</strong>. Basically a scatterplot for discrete variables. The main difference is that a bar chart should always start at an origin of <span class="math inline">\(0\)</span>, whereas dot graphs can use meaningful values in the data to draw the minimum and maximum range of the axis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rincome_summary &lt;-<span class="st"> </span>gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(rincome) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">age =</span> <span class="kw">mean</span>(age, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">tvhours =</span> <span class="kw">mean</span>(tvhours, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">n =</span> <span class="kw">n</span>()
  )

<span class="kw">ggplot</span>(rincome_summary, <span class="kw">aes</span>(age, <span class="kw">fct_reorder</span>(rincome, age))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="gda_files/figure-html/income-plot-1.png" width="672" /></p>
<p>In this situation, arbitrary reordering doesn’t make sense. Income levels have a natural order to them. Instead, perhaps we should maintain that order, but put the non-income values at the bottom of the graph:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(rincome_summary, <span class="kw">aes</span>(age, <span class="kw">fct_relevel</span>(rincome, <span class="st">&quot;Not applicable&quot;</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="gda_files/figure-html/income-bottom-1.png" width="672" /></p>
<p>Why do you think the average age for “Not applicable” is so high?</p>
</div>
</div>
<div id="variations-on-bar-charts" class="section level4">
<h4>Variations on bar charts</h4>
<p>We’ve already seen dot charts. We can also draw <strong>dodged</strong>, <strong>stacked area</strong>, and <strong>proportional</strong> bar charts. These are good for adding another subgroup comparison.</p>
<p>For example, here is a dataset from FiveThirtyEight which includes observations on all gun deaths in the United States from 2012-2014. What is the distribution of gun deaths by intent?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(gun_deaths, <span class="dt">package =</span> <span class="st">&quot;rcfss&quot;</span>)

gun_deaths <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(intent) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">fct_reorder</span>(intent, n, <span class="dt">.desc =</span> <span class="ot">TRUE</span>), n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>()</code></pre></div>
<p><img src="gda_files/figure-html/intent-1.png" width="672" /></p>
<p>Most gun deaths are by suicide, with homicides making up a large component as well. Does this vary by race?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gun_deaths <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(intent, race) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">intent =</span> <span class="kw">factor</span>(intent, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Suicide&quot;</span>, <span class="st">&quot;Homicide&quot;</span>,
                                            <span class="st">&quot;Accidental&quot;</span>, <span class="st">&quot;Undetermined&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(intent, n, <span class="dt">fill =</span> race)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>()</code></pre></div>
<p><img src="gda_files/figure-html/intent-stack-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gun_deaths <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(intent, race) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">intent =</span> <span class="kw">factor</span>(intent, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Suicide&quot;</span>, <span class="st">&quot;Homicide&quot;</span>,
                                            <span class="st">&quot;Accidental&quot;</span>, <span class="st">&quot;Undetermined&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(intent, n, <span class="dt">fill =</span> race)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/intent-dodge-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gun_deaths <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(intent, race) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">intent =</span> <span class="kw">factor</span>(intent, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Suicide&quot;</span>, <span class="st">&quot;Homicide&quot;</span>,
                                            <span class="st">&quot;Accidental&quot;</span>, <span class="st">&quot;Undetermined&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(intent, n, <span class="dt">fill =</span> race)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/intent-fill-1.png" width="672" /></p>
</div>
</div>
<div id="pie-chart" class="section level3">
<h3>Pie chart</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gun_deaths <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(intent) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">with</span>(<span class="kw">pie</span>(pct, <span class="dt">labels =</span> intent, <span class="dt">clockwise =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p><img src="gda_files/figure-html/pie-chart-1.png" width="672" /></p>
<p>Ahh yes, the dreaded <strong>pie chart</strong>. Pie charts are proportional graphs which use angles, arc lengths, and area to identify the frequency of observations in each group. This is different from bar graphs, which use height of the bars (or length) to identify the frequency of observations in each group. Pie charts have received a lot of criticisms from academics and visualization experts. The key question is which is easier to distinguish: line length or area, angle, and arc length?</p>
<blockquote>
<p><a href="http://onlinelibrary.wiley.com.proxy.uchicago.edu/doi/10.1002/acp.2350050106/abstract;jsessionid=E21007114F95498B3EA95F35DD6A21BF.f03t04">Spence, Ian, and Stephan Lewandowsky. “Displaying proportions and percentages.” <em>Applied Cognitive Psychology</em> 5.1 (1991): 61-77.</a></p>
</blockquote>
<p>Experimental evidence suggests angles and arc lengths are more difficult to perceive in their relative size than something like height (i.e. a bar chart).</p>
<p><span class="math display">\[\text{Subjective area} = \text{Area}^.86\]</span></p>
<ul>
<li>People misjudge/misestimate area</li>
<li>This function is not derived from rigorous science</li>
<li>Focus more on the subarea (area/size of individual slices rather than the entire circle)</li>
<li>People also do not generally use pie charts to estimate precise magnitudes (if so, use a table instead)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pie &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>),
                  <span class="dt">value =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">30</span>))

<span class="co"># bar chart</span>
pie_bar &lt;-<span class="st"> </span><span class="kw">ggplot</span>(pie, <span class="kw">aes</span>(label, value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_void2</span>()

<span class="co"># proportional area chart</span>
pie_prop &lt;-<span class="st"> </span>pie <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ymin =</span> <span class="dv">0</span>,
         <span class="dt">ymax =</span> <span class="dv">1</span>,
         <span class="dt">xmax =</span> <span class="kw">cumsum</span>(value),
         <span class="dt">xmin =</span> xmax <span class="op">-</span><span class="st"> </span>value,
         <span class="dt">x =</span> (xmax <span class="op">-</span><span class="st"> </span>xmin) <span class="op">/</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>xmin)

pie_prop &lt;-<span class="st"> </span><span class="kw">ggplot</span>(pie_prop, <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, <span class="dt">xmax =</span> xmax,
             <span class="dt">ymin =</span> ymin, <span class="dt">ymax =</span> ymax)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> pie_prop<span class="op">$</span>x, <span class="dt">labels =</span> pie_prop<span class="op">$</span>label) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_void2</span>()

<span class="co"># pie chart</span>
pie_pie &lt;-<span class="st"> </span><span class="kw">ggplot</span>(pie, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">y =</span> value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label), <span class="dt">position =</span> <span class="kw">position_stack</span>(<span class="dt">vjust =</span> .<span class="dv">5</span>), <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_polar</span>(<span class="dt">theta =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">direction =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

pie_bar <span class="op">+</span>
<span class="st">  </span>pie_prop <span class="op">+</span>
<span class="st">  </span>pie_pie <span class="op">+</span>
<span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">ncol =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="gda_files/figure-html/pie-data-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># table</span>
pie <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(value) <span class="op">%&gt;%</span>
<span class="st">  </span>t <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">col.names =</span> pie<span class="op">$</span>label,
               <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">10</td>
<td align="right">20</td>
<td align="right">40</td>
<td align="right">30</td>
</tr>
</tbody>
</table>
<div id="experiment-1" class="section level4">
<h4>Experiment 1</h4>
<ul>
<li>Compare speed at processing and making comparisons between bar charts and pie charts</li>
<li><strong>No substantial difference in processing time or accuracy of interpretations</strong> - see Figures 2 and 3</li>
</ul>
</div>
<div id="experiment-2" class="section level4">
<h4>Experiment 2</h4>
<ul>
<li>Ordering of the bars/slices didn’t really effect interpretation speed or accuracy - ordering apparently is not a major perceptual strategy</li>
</ul>
</div>
<div id="experiment-3" class="section level4">
<h4>Experiment 3</h4>
<ul>
<li>Pie charts better for A + B vs. C + D comparisons</li>
<li>Hypothesis: in pie charts, adjacent slices were easier to visually combine together</li>
<li>In truth, this didn’t matter - but for bar charts, adjacency actually helped</li>
</ul>
</div>
<div id="takeaways" class="section level4">
<h4>Takeaways</h4>
<ul>
<li>For pure magnitude identification, bar charts are superior</li>
<li>For comparing percentages, either chart is acceptable</li>
<li>To compare combinations of groupings, pie charts are slightly superior</li>
<li>Tables are only useful if you want to report exact percentages</li>
</ul>
</div>
</div>
</div>
</div>
<div id="bivariate-relationships" class="section level1">
<h1>Bivariate relationships</h1>
<div id="scatterplots" class="section level2">
<h2>Scatterplots</h2>
<p>One of the most common plots to use when assessing relationships between continuous variables. Features that can be found in a scatterplot:</p>
<ul>
<li>Causal relationships (linear and nonlinear) - not guaranteed</li>
<li>Associations (correlations)</li>
<li>Outliers or groups of outliers - some observations are outliers in two dimensions but not a single dimension</li>
<li>Clusters</li>
<li>Gaps</li>
<li>Barriers - some combinations of values that may not be possible</li>
<li>Conditional relationships - relationship is conditional on some third variable</li>
</ul>
<div id="movies-example" class="section level3">
<h3><code>movies</code> example</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(movies, <span class="kw">aes</span>(votes, rating)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="gda_files/figure-html/movies-votes-rating-1.png" width="672" /></p>
<p>Insights that could be found include:</p>
<ol style="list-style-type: decimal">
<li>No films with lots of votes and a low average rating</li>
<li>For films with more than a small number of votes, the average rating increases with the number of votes</li>
<li>No film with lots of votes has an average rating close to the maximum (suggests a barrier)</li>
<li>A few films with high number of votes (over 50,000) look like outliers. See the points below the trend</li>
<li>Films with low number of votes have high variance in rating</li>
<li>The only films with very high ratings also have relatively few votes</li>
</ol>
</div>
<div id="smoothing-lines" class="section level3">
<h3>Smoothing lines</h3>
<p>To help identify if a pattern or trend really exists in the scatterplot, we can overlay the plot with a <strong>smoothing line</strong>, or a line derived from a statistical model. This model could be linear or non-linear, parametric or non-parametric - we will discuss specific methods next term.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(movies, <span class="kw">aes</span>(votes, rating)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="gda_files/figure-html/movies-votes-rating-smooth-1.png" width="672" /></p>
<ul>
<li>Adds a non-linear smoothing line to the graph</li>
<li>Suggests a positive, non-linear association between votes and rating</li>
<li>Less confidence in our estimates as votes increase - fewer observations from which to generalize</li>
</ul>
</div>
<div id="adding-jitter-to-the-graph" class="section level3">
<h3>Adding jitter to the graph</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(galton, <span class="kw">aes</span>(parent, child)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="gda_files/figure-html/heights-scatter-1.png" width="672" /></p>
<p>Sometimes continuous variables don’t have many unique values due to rounding, such as Galton’s height dataset. In this situation, we can draw a scatterplot but we cannot see how many unique values actually exist in the dataset. One alternative is to <strong>jitter</strong> each value, or add a bit of random noise to the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> coordinates for each data point. Because the noise is added at random, it should not unfairly distort or bias the graph.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(galton, <span class="kw">aes</span>(parent, child)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>()</code></pre></div>
<p><img src="gda_files/figure-html/heights-jitter-1.png" width="672" /></p>
<p>We can now see that some combinations of parent-child heights are more common than others. Is there a positive trend?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(galton, <span class="kw">aes</span>(parent, child)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> .<span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</code></pre></div>
<p><img src="gda_files/figure-html/galton-smooth-1.png" width="672" /></p>
<p>Here I added a linear (OLS) smoothing line, add a dashed reference line for a perfect 1-to-1 relationship between parent and child height, and fade the data points by adding some transparency, to make the graph less messy. We can see the relationship between parent and child height is positive and somewhat close to 1-to-1, though not precisely.</p>
<p>Note that smoothing lines are not definitive proof of correlation or causation. The relationship seen in the smoothing line could be driven by some third, ungraphed variable. Further exploration is certainly warranted, as well as theory to back up your claims.</p>
</div>
<div id="comparing-groups-within-scatterplots" class="section level3">
<h3>Comparing groups within scatterplots</h3>
<p>If you want to check for conditional relationships using scatterplots, you have a few options. If there is a small number of groups, you could add a color aesthetic to the graph to differentiate between each group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="gda_files/figure-html/auto-drv-1.png" width="672" /></p>
<p>Here we have a dataset of automobiles and want to understand the relationship between engine size and highway fuel efficiency, conditional on the drive-type. By changing the color of each data point based on its group membership, we can see a few things:</p>
<ol style="list-style-type: decimal">
<li>Front wheel drive cars do not have fuel efficiency below 20 MPG</li>
<li>Rear wheel drive cars tend to have larger engines</li>
<li>Within each group, the relationship still tend to be negative</li>
</ol>
<p>However, as the number of groups increases, it becomes more difficult to visually distinguish between each group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="gda_files/figure-html/auto-class-1.png" width="672" /></p>
<p>With seven categories, this is becoming more tricky. What if we have even more categories? Consider a dataset of individual Olympians who competed in the 2012 Summer Olympics.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(oly12, <span class="dt">package =</span> <span class="st">&quot;VGAMdata&quot;</span>)

<span class="kw">ggplot</span>(oly12, <span class="kw">aes</span>(Height, Weight, <span class="dt">color =</span> Sport)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<pre><code>## Warning: Removed 1346 rows containing missing values (geom_point).</code></pre>
<p><img src="gda_files/figure-html/olympics-1.png" width="672" /></p>
<p>Too many categories. Instead, build a facet graph.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">oly12 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Sport =</span> <span class="kw">abbreviate</span>(Sport, <span class="dv">12</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Height, Weight)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>Sport)</code></pre></div>
<pre><code>## Warning: Removed 1346 rows containing missing values (geom_point).</code></pre>
<p><img src="gda_files/figure-html/olympics-facet-1.png" width="672" /></p>
<p>While still a bit cramped, it helps. Now we can see some different features of the data.</p>
<ol style="list-style-type: decimal">
<li>Some sports have no height/weight information for competitors</li>
<li>Some sports have far fewer competitors than others</li>
<li>Across sports, there still seems to be a positive relationship between height and weight</li>
</ol>
<p>If you want to focus your comparison on just a handful of categories, filter the data first and then draw the plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">oly12 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Sport <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Judo&quot;</span>, <span class="st">&quot;Weightlifting&quot;</span>, <span class="st">&quot;Wrestling&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Height, Weight)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>Sport)</code></pre></div>
<pre><code>## Warning: Removed 69 rows containing missing values (geom_point).</code></pre>
<p><img src="gda_files/figure-html/olympics-facet-lite-1.png" width="672" /></p>
</div>
<div id="scatterplot-matrix" class="section level3">
<h3>Scatterplot matrix</h3>
<p>To quickly visualize several variables in a dataset and their relation to one another, a <strong>scatterplot matrix</strong> is a quick and detailed tool for generating a series of scatterplots for each combination of variables. Consider <code>credit.csv</code> which contains a sample of individuals from a credit card company, identifying their total amount of credit card debt and other financial/demographic variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">credit &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/Credit.csv&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># remove first ID column</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>X1)</code></pre></div>
<pre><code>## Warning: Missing column names filled in: &#39;X1&#39; [1]</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   X1 = col_integer(),
##   Income = col_double(),
##   Limit = col_integer(),
##   Rating = col_integer(),
##   Cards = col_integer(),
##   Age = col_integer(),
##   Education = col_integer(),
##   Gender = col_character(),
##   Student = col_character(),
##   Married = col_character(),
##   Ethnicity = col_character(),
##   Balance = col_integer()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(credit) &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_to_lower</span>(<span class="kw">names</span>(credit))   <span class="co"># convert column names to lowercase</span></code></pre></div>
<p>If we want to quickly assess the relationship between all of the variables (in preparation for more advanced statistical learning techniques), we could generate a matrix of scatterplots using the base <code>graphics</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># only graph numeric variables</span>
<span class="kw">pairs</span>(<span class="kw">select_if</span>(credit, is.numeric))</code></pre></div>
<p><img src="gda_files/figure-html/credit-scatter-matrix-1.png" width="672" /></p>
<p>We can use this to look for trends and associations between each set of variables. This base <code>graphics</code> implementation is very minimal, as it is strictly for numeric variables and only shows tinyscatterplots.</p>
<p>We can also use <code>GGally::ggpairs()</code> to generate a scatterplot matrix. <code>GGally</code> is a package for R that extends <code>ggplot2</code> by adding helper functions for common multivariate data structures. <code>ggpairs()</code> is a function that allows us to quickly generate a scatterplot matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(GGally)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;GGally&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     nasa</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggpairs</span>(<span class="kw">select_if</span>(credit, is.numeric))</code></pre></div>
<p><img src="gda_files/figure-html/credit-scatter-ggpairs-1.png" width="672" /></p>
<p>When applied to strictly numeric variables, the lower triangle generates scatterplots, the upper triangle prints the correlation coefficient, and the diagonal panels are density plots of the variable.</p>
<p><code>ggpairs()</code> also works on datasets with a mix of qualitative and quantitative variables, drawing appropriate graphs based on whether the variables are continuous or discrete:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggpairs</span>(<span class="kw">select</span>(rcfss<span class="op">::</span>scorecard, type<span class="op">:</span>debt))</code></pre></div>
<p><img src="gda_files/figure-html/diamonds-scatter-matrix-1.png" width="672" /></p>
</div>
<div id="heatmap-of-correlation-coefficients" class="section level3">
<h3>Heatmap of correlation coefficients</h3>
<p>Scatterplot matricies can provide lots of information, but can also be very densely packed. Perhaps instead we want to quickly visualize the correlation between each of the variables. <code>GGally</code> also contains the <code>ggcorr()</code> function which calculates Pearson’s correlation coefficient for each combination of continuous variables and visualizes them using a heatmap.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggcorr</span>(mpg)</code></pre></div>
<pre><code>## Warning in ggcorr(mpg): data in column(s) &#39;manufacturer&#39;, &#39;model&#39;, &#39;trans&#39;,
## &#39;drv&#39;, &#39;fl&#39;, &#39;class&#39; are not numeric and were ignored</code></pre>
<p><img src="gda_files/figure-html/ggcorr-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggcorr</span>(credit)</code></pre></div>
<pre><code>## Warning in ggcorr(credit): data in column(s) &#39;gender&#39;, &#39;student&#39;,
## &#39;married&#39;, &#39;ethnicity&#39; are not numeric and were ignored</code></pre>
<p><img src="gda_files/figure-html/ggcorr-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggcorr</span>(diamonds)</code></pre></div>
<pre><code>## Warning in ggcorr(diamonds): data in column(s) &#39;cut&#39;, &#39;color&#39;, &#39;clarity&#39;
## are not numeric and were ignored</code></pre>
<p><img src="gda_files/figure-html/ggcorr-3.png" width="672" /></p>
<p>We quickly see for each dataset which variables are correlated most strongly with one another. <code>ggcorr()</code> also allows customization of the appearance of the heatmap. For example, we can display the actual correlation coefficient directly in the graph by setting <code>label = TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggcorr</span>(credit, <span class="dt">label =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning in ggcorr(credit, label = TRUE): data in column(s) &#39;gender&#39;,
## &#39;student&#39;, &#39;married&#39;, &#39;ethnicity&#39; are not numeric and were ignored</code></pre>
<p><img src="gda_files/figure-html/ggcorr-label-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggcorr</span>(credit, <span class="dt">label =</span> <span class="ot">TRUE</span>, <span class="dt">label_round =</span> <span class="dv">2</span>, <span class="dt">label_alpha =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning in ggcorr(credit, label = TRUE, label_round = 2, label_alpha =
## TRUE): data in column(s) &#39;gender&#39;, &#39;student&#39;, &#39;married&#39;, &#39;ethnicity&#39; are
## not numeric and were ignored</code></pre>
<p><img src="gda_files/figure-html/ggcorr-label-2.png" width="672" /></p>
</div>
</div>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">session_info</span>()</code></pre></div>
<pre><code>## Session info -------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.5.1 (2018-07-02)
##  system   x86_64, darwin15.6.0        
##  ui       RStudio (1.1.456)           
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2018-10-25</code></pre>
<pre><code>## Packages -----------------------------------------------------------------</code></pre>
<pre><code>##  package    * version date       source                              
##  assertthat   0.2.0   2017-04-11 CRAN (R 3.5.0)                      
##  backports    1.1.2   2017-12-13 CRAN (R 3.5.0)                      
##  base       * 3.5.1   2018-07-05 local                               
##  bindr        0.1.1   2018-03-13 CRAN (R 3.5.0)                      
##  bindrcpp   * 0.2.2   2018-03-29 CRAN (R 3.5.0)                      
##  broom      * 0.5.0   2018-07-17 CRAN (R 3.5.0)                      
##  cellranger   1.1.0   2016-07-27 CRAN (R 3.5.0)                      
##  cli          1.0.0   2017-11-05 CRAN (R 3.5.0)                      
##  colorspace   1.3-2   2016-12-14 CRAN (R 3.5.0)                      
##  compiler     3.5.1   2018-07-05 local                               
##  crayon       1.3.4   2017-09-16 CRAN (R 3.5.0)                      
##  datasets   * 3.5.1   2018-07-05 local                               
##  devtools     1.13.6  2018-06-27 CRAN (R 3.5.0)                      
##  digest       0.6.15  2018-01-28 CRAN (R 3.5.0)                      
##  dplyr      * 0.7.6   2018-06-29 cran (@0.7.6)                       
##  evaluate     0.11    2018-07-17 CRAN (R 3.5.0)                      
##  forcats    * 0.3.0   2018-02-19 CRAN (R 3.5.0)                      
##  ggplot2    * 3.0.0   2018-07-03 CRAN (R 3.5.0)                      
##  ggthemes   * 4.0.0   2018-07-19 CRAN (R 3.5.0)                      
##  glue         1.3.0   2018-07-17 CRAN (R 3.5.0)                      
##  graphics   * 3.5.1   2018-07-05 local                               
##  grDevices  * 3.5.1   2018-07-05 local                               
##  grid         3.5.1   2018-07-05 local                               
##  gtable       0.2.0   2016-02-26 CRAN (R 3.5.0)                      
##  haven        1.1.2   2018-06-27 CRAN (R 3.5.0)                      
##  hms          0.4.2   2018-03-10 CRAN (R 3.5.0)                      
##  htmltools    0.3.6   2017-04-28 CRAN (R 3.5.0)                      
##  httr         1.3.1   2017-08-20 CRAN (R 3.5.0)                      
##  jsonlite     1.5     2017-06-01 CRAN (R 3.5.0)                      
##  knitr      * 1.20    2018-02-20 CRAN (R 3.5.0)                      
##  labeling     0.3     2014-08-23 CRAN (R 3.5.0)                      
##  lattice      0.20-35 2017-03-25 CRAN (R 3.5.1)                      
##  lazyeval     0.2.1   2017-10-29 CRAN (R 3.5.0)                      
##  lubridate    1.7.4   2018-04-11 CRAN (R 3.5.0)                      
##  magrittr     1.5     2014-11-22 CRAN (R 3.5.0)                      
##  memoise      1.1.0   2017-04-21 CRAN (R 3.5.0)                      
##  methods    * 3.5.1   2018-07-05 local                               
##  modelr       0.1.2   2018-05-11 CRAN (R 3.5.0)                      
##  munsell      0.5.0   2018-06-12 CRAN (R 3.5.0)                      
##  nlme         3.1-137 2018-04-07 CRAN (R 3.5.1)                      
##  patchwork  * 0.0.1   2018-09-06 Github (thomasp85/patchwork@7fb35b1)
##  pillar       1.3.0   2018-07-14 CRAN (R 3.5.0)                      
##  pkgconfig    2.0.2   2018-08-16 CRAN (R 3.5.1)                      
##  plyr         1.8.4   2016-06-08 CRAN (R 3.5.0)                      
##  purrr      * 0.2.5   2018-05-29 CRAN (R 3.5.0)                      
##  R6           2.2.2   2017-06-17 CRAN (R 3.5.0)                      
##  rcfss        0.1.5   2018-05-30 local                               
##  Rcpp         0.12.18 2018-07-23 CRAN (R 3.5.0)                      
##  readr      * 1.1.1   2017-05-16 CRAN (R 3.5.0)                      
##  readxl       1.1.0   2018-04-20 CRAN (R 3.5.0)                      
##  rlang        0.2.1   2018-05-30 CRAN (R 3.5.0)                      
##  rmarkdown    1.10    2018-06-11 CRAN (R 3.5.0)                      
##  rprojroot    1.3-2   2018-01-03 CRAN (R 3.5.0)                      
##  rsconnect    0.8.8   2018-03-09 CRAN (R 3.5.0)                      
##  rstudioapi   0.7     2017-09-07 CRAN (R 3.5.0)                      
##  rvest        0.3.2   2016-06-17 CRAN (R 3.5.0)                      
##  scales       1.0.0   2018-08-09 CRAN (R 3.5.0)                      
##  stats      * 3.5.1   2018-07-05 local                               
##  stringi      1.2.4   2018-07-20 CRAN (R 3.5.0)                      
##  stringr    * 1.3.1   2018-05-10 CRAN (R 3.5.0)                      
##  tibble     * 1.4.2   2018-01-22 CRAN (R 3.5.0)                      
##  tidyr      * 0.8.1   2018-05-18 CRAN (R 3.5.0)                      
##  tidyselect   0.2.4   2018-02-26 CRAN (R 3.5.0)                      
##  tidyverse  * 1.2.1   2017-11-14 CRAN (R 3.5.0)                      
##  tools        3.5.1   2018-07-05 local                               
##  utils      * 3.5.1   2018-07-05 local                               
##  withr        2.1.2   2018-03-15 CRAN (R 3.5.0)                      
##  xml2         1.2.0   2018-01-24 CRAN (R 3.5.0)                      
##  yaml         2.2.0   2018-07-25 CRAN (R 3.5.0)</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Source: <a href="https://link-springer-com.proxy.uchicago.edu/book/10.1007%2F978-0-387-71762-3">Interactive and Dynamic Graphics for Data Analysis: With R and Ggobi</a>. Data obtained from: <a href="http://www.ggobi.org/book/">The GGobi Book</a>.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Note we calculate a new variable <code>tiprate</code>, which is <span class="math inline">\(\frac{\text{tip}}{\text{totbill}}\)</span><a href="#fnref2">↩</a></p></li>
</ol>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
